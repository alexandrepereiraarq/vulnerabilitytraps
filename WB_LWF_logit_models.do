clear

**Open DataFrame in CSV
global file_path = "./"
global out_file_name = "WB_LWF_Logit Regression Models.xlsx"

global out_file_path_name = "$file_path" + "$out_file_name"

***three options in this version: only the protected households, only the unprotected or both**
*local in_file_name = "$file_path" + "WB_LWF_floods_v33_unprotected.csv"
*local in_file_name = "$file_path" + "WB_LWF_floods_v33_protected.csv"
local in_file_name = "$file_path" + "WB_LWF_floods_v33.csv"

import delimited "`in_file_name'"

***** Generate dummy variables / independent variables

tabulate p012s, generate(dump012)
tabulate p015s, generate(dump015)
tabulate p018s, generate(dump018)
tabulate p029s, generate(dump029)
tabulate p041s, generate(dump041)
tabulate p098s, generate(dump098)

*********************************************P041 'SIM'*********************************************
****** Model 1 - explaining variable only
*explaining variable: P070 (risk response) 
*including P043 = 'Yes' as P070op14

*dependent variable: P041 'Sim' (those who were aware of flooding) (dump0412)
forvalues i= 1/14 {
    logit p070op`i' dump0412, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M1_P070op`i', replace)
	putexcel (A1) = etable
	sleep 250
	putexcel (I1) = "Number of obs"
	sleep 250
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 250
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 250
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 250
	putexcel (J4) = ( `e(r2_p)' )
} 
****** Model 2 - explaining variable + income
forvalues i= 1/14 {
    logit p070op`i' dump0412 p264n, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M2_P070op`i', replace)
	putexcel (A1) = etable
	sleep 250
	putexcel (I1) = "Number of obs"
	sleep 250
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 250
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 250
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 250
	putexcel (J4) = ( `e(r2_p)' )
} 

****** Model 3 - explaining variable + income + age
forvalues i= 1/14 {
    logit p070op`i' dump0412 p264n p013n, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M3_P070op`i', replace)
	putexcel (A1) = etable
	sleep 250
	putexcel (I1) = "Number of obs"
	sleep 250
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 250
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 250
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 250
	putexcel (J4) = ( `e(r2_p)' )
} 

****** Model 4 - explaining variable + income + age + persons in hh
forvalues i= 1/14 {
	logit p070op`i' dump0412 p264n p013n p009, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M4_P070op`i', replace)
	putexcel (A1) = etable
	sleep 250
	putexcel (I1) = "Number of obs"
	sleep 250
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 250
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 250
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 250
	putexcel (J4) = ( `e(r2_p)' )
} 

****** Model 5 - explaining variable + income + age + ethnicity
forvalues i= 1/14 {
    logit p070op`i' dump0412 p264n p013n dump0293 dump0294 dump0295 dump0296, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M5_P070op`i', replace)
	putexcel (A1) = etable
	sleep 1000
	putexcel (I1) = "Number of obs"
	sleep 1000
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 1000
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 1000
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 1000
	putexcel (J4) = ( `e(r2_p)' )
} 

****** Model 6 - explaining variable + income + age + ethnicity + persons in hh + transp. mode available (dump0182)

forvalues i= 1/14 {
    logit p070op`i' dump0412 p264n p013n dump0293 dump0294 dump0295 dump0296 p009 dump0182, iterate(20)
	putexcel set "$out_file_path_name", modify sheet(M6_P070op`i', replace)
	putexcel (A1) = etable
	sleep 1000
	putexcel (I1) = "Number of obs"
	sleep 1000
	putexcel (J1) = (`e(N)' )
	putexcel (I2) = "chi2"
	sleep 1000
	putexcel (J2) = (`e(chi2)' )
	putexcel (I3) = "Prob > chi2"
	sleep 1000
	putexcel (J3) = ( `e(p)' )
	putexcel (I4) = "Pseudo R2"
	sleep 1000
	putexcel (J4) = ( `e(r2_p)' )
} 
